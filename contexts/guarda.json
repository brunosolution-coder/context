{
  "id": "guarda-dinheiro",
  "nome": "GuardaDinheiro",
  "descricao": "SaaS de gestÃ£o financeira pessoal com IA, sistema de tiers (Free/Pro/Premium), 5.000+ usuÃ¡rios",
  "stack": "React 18, Vite 7, Supabase 2.75, Stripe 19, Vercel, OpenAI, Sentry, Tailwind 3.4",
  
  "project_context": "# GUARDADINHEIRO - CONTEXTO COMPLETO\n\n## SOBRE O PROJETO\n- **Tipo:** SaaS B2C de gestÃ£o financeira pessoal\n- **Status:** ProduÃ§Ã£o com 5.000+ usuÃ¡rios (preparando lanÃ§amento pÃºblico)\n- **Desenvolvedor:** Bruno Sena (Brasil)\n- **Objetivo Atual:** Estabilizar + polish para lanÃ§amento em 3 semanas\n- **Modelo de NegÃ³cio:** Freemium (Free â†’ Pro R$29/mÃªs â†’ Premium R$99/mÃªs)\n\n## PRINCIPAIS FUNCIONALIDADES\n\n### 1. CONTROLE DE TRANSAÃ‡Ã•ES (âœ… Completo)\n- Registro ilimitado de entradas/saÃ­das\n- CategorizaÃ§Ã£o automÃ¡tica com IA\n- Anexos de comprovantes\n- TransaÃ§Ãµes recorrentes (PRO)\n- ImportaÃ§Ã£o CSV/Excel (PRO)\n- Busca e filtros avanÃ§ados\n\n### 2. ORÃ‡AMENTOS PERSONALIZADOS (âœ… Completo)\n- CriaÃ§Ã£o por categoria (5 no Free, âˆ no Pro)\n- VisualizaÃ§Ã£o de progresso em tempo real\n- Alertas de limite (PRO)\n- Dicas contextuais de economia (PRO)\n- CelebraÃ§Ãµes ao completar orÃ§amento (PRO)\n- ComparaÃ§Ã£o entre perÃ­odos (PREMIUM)\n\n### 3. METAS FINANCEIRAS (âœ… Completo)\n- DefiniÃ§Ã£o de objetivos (3 no Free, âˆ no Pro)\n- Tracking de progresso visual\n- ProjeÃ§Ãµes futuras com IA (PRO)\n- Metas diÃ¡rias automÃ¡ticas (PRO)\n- Milestones e celebraÃ§Ãµes (PRO)\n- RecomendaÃ§Ãµes inteligentes (PREMIUM)\n\n### 4. INSIGHTS COM IA (âœ… Completo - PRO/PREMIUM)\n- AnÃ¡lise de padrÃµes de gastos\n- RecomendaÃ§Ãµes acionÃ¡veis\n- Resumo mensal automÃ¡tico\n- Insights por categoria\n- AnÃ¡lise de tendÃªncias\n- PrevisÃµes financeiras (PREMIUM)\n\n### 5. ASSISTENTE IA SOFIA (âœ… Completo - PREMIUM)\n- Chat interativo com GPT-4\n- Respostas contextualizadas aos dados do usuÃ¡rio\n- SugestÃµes de economia personalizadas\n- Rate limiting (20 msgs/dia)\n\n### 6. GAMIFICAÃ‡ÃƒO (âœ… Completo)\n- Daily streaks (login diÃ¡rio)\n- Conquistas por marcos financeiros\n- CelebraÃ§Ãµes animadas\n- Sistema de nÃ­veis\n\n## SISTEMA DE TIERS (33 FEATURES)\n\n**FREE (8 features):**\n- TransaÃ§Ãµes ilimitadas\n- 5 orÃ§amentos\n- 3 metas\n- Dashboard bÃ¡sico\n- HistÃ³rico de transaÃ§Ãµes\n- Busca bÃ¡sica\n- Streaks diÃ¡rios\n- SincronizaÃ§Ã£o manual\n\n**PRO - R$29/mÃªs (15 features):**\n- Tudo do FREE +\n- OrÃ§amentos ilimitados\n- Metas ilimitadas\n- TransaÃ§Ãµes recorrentes\n- CategorizaÃ§Ã£o IA\n- Import CSV/Excel\n- Analytics avanÃ§ado\n- Insights IA\n- Alertas de orÃ§amento\n- Dicas de economia\n- CelebraÃ§Ãµes\n- MÃºltiplas contas\n- ProjeÃ§Ãµes futuras\n- ComparaÃ§Ã£o perÃ­odos\n- ExportaÃ§Ã£o Excel\n\n**PREMIUM - R$99/mÃªs (17 features):**\n- Tudo do PRO +\n- Chat IA Sofia\n- API access (futuro)\n- Webhooks (futuro)\n- Suporte prioritÃ¡rio\n- RelatÃ³rios customizados\n- PrevisÃµes avanÃ§adas\n- RecomendaÃ§Ãµes premium\n\n## STACK TÃ‰CNICA DETALHADA\n\n**Frontend:**\n- React 18.2.0 (UI)\n- Vite 7.2.2 (build tool ultra-rÃ¡pido)\n- React Router DOM 7.9.4 (routing)\n- Tailwind CSS 3.4.1 (styling utilitÃ¡rio)\n- Recharts 3.4.1 (grÃ¡ficos interativos)\n- Lucide React 0.546.0 (Ã­cones)\n- @stripe/stripe-js 8.2.0 (checkout embutido)\n- html2canvas + jspdf (export PDF)\n- xlsx 0.18.5 (export Excel)\n\n**Backend/Serverless:**\n- Vercel Functions (Node.js)\n- Express 5.1.0 (API local dev)\n- Stripe 19.2.0 (pagamentos)\n- @supabase/supabase-js 2.75.0 (database + auth)\n- OpenAI API (Sofia - assistente IA)\n- @sentry/react 10.22.0 (error tracking)\n- react-ga4 2.1.0 (analytics)\n\n**Database:**\n- PostgreSQL via Supabase\n- RLS Policies (Row Level Security)\n- Tabelas principais: profiles, transactions, budgets, goals, subscriptions\n- Webhooks Stripe â†’ Supabase sync\n\n**Hosting:**\n- Vercel (frontend + functions)\n- Supabase (database + auth)\n- Stripe (payments + customer portal)\n\n## ARQUIVOS PRINCIPAIS NO PROJETO\n- `src/App.tsx` - App principal com roteamento\n- `src/components/FeatureUnlock.jsx` - â­ Feature gating (blur + upgrade)\n- `src/hooks/useFeatureAccess.js` - â­ Controle de acesso a 33 features\n- `src/context/TierContext.jsx` - â­ Estado global de planos\n- `src/lib/supabase.js` - Cliente Supabase configurado\n- `src/lib/stripe.js` - Stripe embedded checkout\n- `src/lib/subscription.js` - Gerenciamento de checkouts\n- `api/create-checkout-session.js` - â­ Cria sessÃ£o Stripe\n- `api/webhooks/stripe.js` - â­ Processa webhooks Stripe\n- `.env` - â­ Credenciais (NUNCA commitar)\n\n## FLUXO DE CHECKOUT (CRÃTICO)\n1. User clica \"Upgrade to Pro\"\n2. Frontend chama `api/create-checkout-session.js`\n3. Backend cria Stripe Checkout Session\n4. User redirecionado para Stripe\n5. User paga â†’ Stripe envia webhook\n6. `api/webhooks/stripe.js` recebe evento\n7. Atualiza `profiles.plan_slug` no Supabase\n8. User redirecionado de volta â†’ vÃª upgrade\n\n## CREDENCIAIS SUPABASE (DEV)\n- URL: https://nldhhkytxdaqaslmczsi.supabase.co\n- Email teste: dev@test.com / Senha: Test1234!\n- âš ï¸ NUNCA commitar .env (jÃ¡ estÃ¡ em .gitignore)\n\n## DOCUMENTAÃ‡ÃƒO INTERNA (LER SEMPRE)\n- `.claude/GUARDADINHEIRO_INVENTARIO_COMPLETO.md` - 61 componentes mapeados\n- `.claude/GUARDADINHEIRO_REGRAS_CRITICAS_E_ROADMAP.md` - Problemas conhecidos + roadmap\n- `.claude/PROMPT_PARA_IA_GUARDADINHEIRO.md` - Como trabalhar no projeto",
  
  "architecture": "# GUARDADINHEIRO - ARQUITETURA\n\n## ESTRUTURA DE PASTAS COMPLETA\n\n```\nguarda/\nâ”œâ”€â”€ src/\nâ”‚   â”œâ”€â”€ components/          (61 componentes React)\nâ”‚   â”‚   â”œâ”€â”€ Auth/\nâ”‚   â”‚   â”‚   â”œâ”€â”€ LoginForm.jsx\nâ”‚   â”‚   â”‚   â””â”€â”€ AuthCallback.jsx\nâ”‚   â”‚   â”œâ”€â”€ Dashboard/\nâ”‚   â”‚   â”‚   â”œâ”€â”€ DashboardSummary.jsx\nâ”‚   â”‚   â”‚   â”œâ”€â”€ RecentTransactions.jsx\nâ”‚   â”‚   â”‚   â””â”€â”€ QuickActions.jsx\nâ”‚   â”‚   â”œâ”€â”€ Transactions/\nâ”‚   â”‚   â”‚   â”œâ”€â”€ TransactionList.jsx\nâ”‚   â”‚   â”‚   â”œâ”€â”€ TransactionForm.jsx\nâ”‚   â”‚   â”‚   â””â”€â”€ CategorySelector.jsx\nâ”‚   â”‚   â”œâ”€â”€ Budgets/\nâ”‚   â”‚   â”‚   â”œâ”€â”€ BudgetCard.jsx\nâ”‚   â”‚   â”‚   â”œâ”€â”€ BudgetForm.jsx\nâ”‚   â”‚   â”‚   â””â”€â”€ BudgetProgress.jsx\nâ”‚   â”‚   â”œâ”€â”€ Goals/\nâ”‚   â”‚   â”‚   â”œâ”€â”€ GoalCard.jsx\nâ”‚   â”‚   â”‚   â”œâ”€â”€ GoalForm.jsx\nâ”‚   â”‚   â”‚   â””â”€â”€ GoalProgress.jsx\nâ”‚   â”‚   â”œâ”€â”€ Reports/\nâ”‚   â”‚   â”‚   â”œâ”€â”€ SpendingChart.jsx\nâ”‚   â”‚   â”‚   â”œâ”€â”€ CategoryBreakdown.jsx\nâ”‚   â”‚   â”‚   â””â”€â”€ TrendAnalysis.jsx\nâ”‚   â”‚   â”œâ”€â”€ AI/\nâ”‚   â”‚   â”‚   â”œâ”€â”€ ChatAssistant.jsx (PREMIUM)\nâ”‚   â”‚   â”‚   â””â”€â”€ InsightCard.jsx (PRO)\nâ”‚   â”‚   â”œâ”€â”€ Layout/\nâ”‚   â”‚   â”‚   â”œâ”€â”€ Navbar.jsx\nâ”‚   â”‚   â”‚   â”œâ”€â”€ Sidebar.jsx\nâ”‚   â”‚   â”‚   â””â”€â”€ Header.jsx\nâ”‚   â”‚   â”œâ”€â”€ FeatureUnlock.jsx      â­ CRÃTICO: Feature gating\nâ”‚   â”‚   â”œâ”€â”€ TierBadge.jsx          â­ Indicador de plano\nâ”‚   â”‚   â”œâ”€â”€ CheckoutModal.jsx      â­ Stripe embedded checkout\nâ”‚   â”‚   â”œâ”€â”€ SubscriptionGuard.jsx  â­ Guard de assinatura\nâ”‚   â”‚   â””â”€â”€ [outros 47 componentes]\nâ”‚   â”‚\nâ”‚   â”œâ”€â”€ hooks/              (9 hooks customizados)\nâ”‚   â”‚   â”œâ”€â”€ useAuth.js            â­ Auth Google + Supabase\nâ”‚   â”‚   â”œâ”€â”€ usePlans.js           â­ Planos e assinatura\nâ”‚   â”‚   â”œâ”€â”€ useFeatureAccess.js   â­â­ Control 33 features\nâ”‚   â”‚   â”œâ”€â”€ useTierTheme.js       Tema por tier\nâ”‚   â”‚   â”œâ”€â”€ useCopyByTier.js      Mensagens contextualizadas\nâ”‚   â”‚   â”œâ”€â”€ useAnimationByTier.js AnimaÃ§Ãµes diferenciadas\nâ”‚   â”‚   â”œâ”€â”€ useStreak.js          Daily streaks\nâ”‚   â”‚   â”œâ”€â”€ useGamification.js    Conquistas\nâ”‚   â”‚   â””â”€â”€ useToast.js           NotificaÃ§Ãµes\nâ”‚   â”‚\nâ”‚   â”œâ”€â”€ context/\nâ”‚   â”‚   â””â”€â”€ TierContext.jsx       â­â­ Estado global tier system\nâ”‚   â”‚\nâ”‚   â”œâ”€â”€ lib/\nâ”‚   â”‚   â”œâ”€â”€ supabase.js           â­ Cliente Supabase\nâ”‚   â”‚   â”œâ”€â”€ stripe.js             â­ Config Stripe\nâ”‚   â”‚   â”œâ”€â”€ subscription.js       â­ Gerencia checkout\nâ”‚   â”‚   â”œâ”€â”€ features.js           â­ Sistema de features (FEATURE_MATRIX)\nâ”‚   â”‚   â””â”€â”€ pricing.js            PreÃ§os dos planos\nâ”‚   â”‚\nâ”‚   â”œâ”€â”€ pages/              (12 pÃ¡ginas)\nâ”‚   â”‚   â”œâ”€â”€ LoginPage.jsx\nâ”‚   â”‚   â”œâ”€â”€ DashboardPage.jsx\nâ”‚   â”‚   â”œâ”€â”€ TransactionsPage.jsx\nâ”‚   â”‚   â”œâ”€â”€ BudgetsPage.jsx\nâ”‚   â”‚   â”œâ”€â”€ GoalsPage.jsx\nâ”‚   â”‚   â”œâ”€â”€ ReportsPage.jsx\nâ”‚   â”‚   â”œâ”€â”€ PricingPage.jsx       â­ PÃ¡gina de planos\nâ”‚   â”‚   â”œâ”€â”€ ProfilePage.jsx\nâ”‚   â”‚   â”œâ”€â”€ SettingsPage.jsx\nâ”‚   â”‚   â”œâ”€â”€ AIAssistantPage.jsx   (PREMIUM)\nâ”‚   â”‚   â”œâ”€â”€ NotFoundPage.jsx\nâ”‚   â”‚   â””â”€â”€ ErrorPage.jsx\nâ”‚   â”‚\nâ”‚   â”œâ”€â”€ utils/\nâ”‚   â”‚   â”œâ”€â”€ formatters.js         Formatar moeda, datas\nâ”‚   â”‚   â”œâ”€â”€ validators.js         ValidaÃ§Ãµes de forms\nâ”‚   â”‚   â”œâ”€â”€ calculations.js       CÃ¡lculos financeiros\nâ”‚   â”‚   â””â”€â”€ pdfExport.js          Export PDF\nâ”‚   â”‚\nâ”‚   â”œâ”€â”€ App.tsx                   â­ App principal + routing\nâ”‚   â”œâ”€â”€ main.tsx                  Entry point\nâ”‚   â””â”€â”€ index.css                 Estilos globais + Tailwind\nâ”‚\nâ”œâ”€â”€ api/                    (6 endpoints serverless)\nâ”‚   â”œâ”€â”€ create-checkout-session.js    â­â­ CRÃTICO: Cria checkout Stripe\nâ”‚   â”œâ”€â”€ create-portal-session.js      Customer portal Stripe\nâ”‚   â”œâ”€â”€ sync-subscription.js          Sincroniza plano (DEV only)\nâ”‚   â”œâ”€â”€ chat-assistant.js            OpenAI backend (PREMIUM)\nâ”‚   â”œâ”€â”€ webhooks/\nâ”‚   â”‚   â””â”€â”€ stripe.js                â­â­ CRÃTICO: Webhooks Stripe\nâ”‚   â””â”€â”€ utils/\nâ”‚       â””â”€â”€ rateLimiter.js           Rate limiting IA\nâ”‚\nâ”œâ”€â”€ public/\nâ”‚   â”œâ”€â”€ avatars/              Avatars de usuÃ¡rios\nâ”‚   â”œâ”€â”€ favicon.svg\nâ”‚   â””â”€â”€ [outros assets]\nâ”‚\nâ”œâ”€â”€ supabase/\nâ”‚   â””â”€â”€ migrations/           MigraÃ§Ãµes SQL (se houver)\nâ”‚\nâ”œâ”€â”€ .claude/                  â­ DOCUMENTAÃ‡ÃƒO INTERNA\nâ”‚   â”œâ”€â”€ GUARDADINHEIRO_INVENTARIO_COMPLETO.md\nâ”‚   â”œâ”€â”€ GUARDADINHEIRO_REGRAS_CRITICAS_E_ROADMAP.md\nâ”‚   â””â”€â”€ PROMPT_PARA_IA_GUARDADINHEIRO.md\nâ”‚\nâ”œâ”€â”€ .env                      â­â­ CRÃTICO: Credenciais\nâ”œâ”€â”€ package.json              DependÃªncias\nâ”œâ”€â”€ vite.config.js            Config Vite\nâ”œâ”€â”€ tailwind.config.js        Config Tailwind\nâ”œâ”€â”€ vercel.json               Deploy Vercel\nâ””â”€â”€ tsconfig.json             Config TypeScript\n```\n\n## DATABASE SCHEMA (Supabase PostgreSQL)\n\n```sql\n-- Tabela: profiles (usuÃ¡rios)\nCREATE TABLE profiles (\n  id UUID PRIMARY KEY REFERENCES auth.users,\n  email TEXT,\n  full_name TEXT,\n  avatar_url TEXT,\n  plan_slug TEXT DEFAULT 'free',  -- â­ 'free' | 'pro' | 'premium'\n  stripe_customer_id TEXT,\n  stripe_subscription_id TEXT,\n  subscription_status TEXT,       -- 'active' | 'canceled' | 'past_due'\n  created_at TIMESTAMP DEFAULT NOW(),\n  updated_at TIMESTAMP DEFAULT NOW()\n);\n\n-- Tabela: transactions\nCREATE TABLE transactions (\n  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),\n  user_id UUID REFERENCES profiles(id),\n  type TEXT,              -- 'income' | 'expense'\n  amount DECIMAL,\n  category TEXT,\n  description TEXT,\n  date DATE,\n  is_recurring BOOLEAN DEFAULT false,\n  attachment_url TEXT,\n  created_at TIMESTAMP DEFAULT NOW()\n);\n\n-- Tabela: budgets\nCREATE TABLE budgets (\n  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),\n  user_id UUID REFERENCES profiles(id),\n  category TEXT,\n  amount DECIMAL,\n  period TEXT,            -- 'monthly' | 'weekly'\n  start_date DATE,\n  end_date DATE,\n  created_at TIMESTAMP DEFAULT NOW()\n);\n\n-- Tabela: goals\nCREATE TABLE goals (\n  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),\n  user_id UUID REFERENCES profiles(id),\n  title TEXT,\n  target_amount DECIMAL,\n  current_amount DECIMAL DEFAULT 0,\n  deadline DATE,\n  status TEXT DEFAULT 'active',  -- 'active' | 'completed' | 'cancelled'\n  created_at TIMESTAMP DEFAULT NOW()\n);\n\n-- RLS Policies (Row Level Security)\n-- Cada usuÃ¡rio sÃ³ vÃª seus prÃ³prios dados\nALTER TABLE profiles ENABLE ROW LEVEL SECURITY;\nALTER TABLE transactions ENABLE ROW LEVEL SECURITY;\nALTER TABLE budgets ENABLE ROW LEVEL SECURITY;\nALTER TABLE goals ENABLE ROW LEVEL SECURITY;\n```\n\n## PADRÃ•ES DE CÃ“DIGO\n\n### 1. Naming Conventions\n```javascript\n// âœ… Componentes: PascalCase\nCheckoutModal.jsx\nFeatureUnlock.jsx\n\n// âœ… Hooks: camelCase com 'use'\nuseFeatureAccess.js\nusePlans.js\n\n// âœ… UtilitÃ¡rios: camelCase\nrateLimiter.js\nformatters.js\n\n// âœ… Context: PascalCase\nTierContext.jsx\n\n// âœ… Constantes: UPPER_SNAKE_CASE\nFEATURE_MATRIX\nPLAN_PRICES\n```\n\n### 2. Error Handling\n```javascript\n// âœ… SEMPRE usar try-catch em operaÃ§Ãµes async\ntry {\n  const { data, error } = await supabase\n    .from('transactions')\n    .insert(newTransaction);\n  \n  if (error) throw error;\n  \n  return { success: true, data };\n} catch (error) {\n  console.error('[GuardaDinheiro] Erro ao criar transaÃ§Ã£o:', error);\n  return { success: false, error: error.message };\n}\n\n// âŒ NUNCA deixar erro propagar sem tratamento\nconst data = await supabase.from('transactions').select(); // Sem try-catch\n```\n\n### 3. Feature Gating Pattern\n```jsx\n// âœ… PADRÃƒO: Usar FeatureUnlock para bloquear features\nimport { FeatureUnlock } from '../components/FeatureUnlock';\n\nexport function MinhaFeaturePaga() {\n  return (\n    <FeatureUnlock featureId=\"ai_assistant_chat\" showPrompt={true}>\n      <ChatAssistant />\n    </FeatureUnlock>\n  );\n}\n\n// âœ… ALTERNATIVA: Verificar acesso antes de renderizar\nimport { useFeatureAccess } from '../hooks/useFeatureAccess';\n\nexport function MeuComponente() {\n  const { hasAccess } = useFeatureAccess();\n  \n  if (!hasAccess('bulk_import')) {\n    return <UpgradePrompt feature=\"bulk_import\" />;\n  }\n  \n  return <BulkImportUI />;\n}\n```\n\n### 4. API Routes (Vercel Functions)\n```javascript\n// âœ… SEMPRE validar auth token\nexport default async function handler(req, res) {\n  // CORS\n  res.setHeader('Access-Control-Allow-Origin', '*');\n  \n  if (req.method === 'OPTIONS') {\n    return res.status(200).end();\n  }\n  \n  // Validar auth\n  const token = req.headers.authorization?.replace('Bearer ', '');\n  if (!token) {\n    return res.status(401).json({ error: 'Unauthorized' });\n  }\n  \n  // Validar com Supabase\n  const { data: { user }, error } = await supabase.auth.getUser(token);\n  if (error || !user) {\n    return res.status(401).json({ error: 'Invalid token' });\n  }\n  \n  // Processar request...\n  try {\n    const result = await processRequest(user, req.body);\n    return res.status(200).json({ success: true, data: result });\n  } catch (error) {\n    console.error('[API] Erro:', error);\n    return res.status(500).json({ error: 'Internal error' });\n  }\n}\n```\n\n### 5. Supabase Queries\n```javascript\n// âœ… SEMPRE usar RLS policies (automÃ¡tico se logado)\nconst { data, error } = await supabase\n  .from('transactions')\n  .select('*')\n  .eq('user_id', user.id)  // RLS jÃ¡ filtra, mas bom explicitar\n  .order('date', { ascending: false });\n\n// âœ… SEMPRE checar erro\nif (error) {\n  console.error('[Supabase] Erro:', error);\n  throw new Error(error.message);\n}\n\n// âŒ NUNCA assumir que query funcionou\nconst data = await supabase.from('transactions').select(); // Sem verificar error\n```\n\n## FEATURE_MATRIX (useFeatureAccess.js)\n\n```javascript\n// â­â­ ESTE Ã‰ O ARQUIVO MAIS CRÃTICO DO PROJETO\n// LocalizaÃ§Ã£o: src/hooks/useFeatureAccess.js (linhas 14-51)\n\nconst FEATURE_MATRIX = {\n  // FREE tier (8 features)\n  free: [\n    'unlimited_transactions',\n    'transaction_history_view',\n    'transaction_search',\n    'budget_creation',        // limite: 5\n    'goal_creation',          // limite: 3\n    'daily_streak_tracking',\n  ],\n  \n  // PRO tier (15 features = FREE + 7 novas)\n  pro: [\n    ...FEATURE_MATRIX.free,\n    'recurring_transactions',\n    'smart_categorization',\n    'bulk_import',\n    'csv_export',\n    'budget_progress_visualization',\n    'budget_alerts',\n    'budget_tips',\n    'goal_progress_tracking',\n    'spending_pattern_analytics',\n    'actionable_recommendations',\n    'monthly_summary',\n    'smart_insights',\n  ],\n  \n  // PREMIUM tier (17 features = PRO + 2 novas)\n  premium: [\n    ...FEATURE_MATRIX.pro,\n    'ai_assistant_chat',\n    'forecast_analysis',\n  ]\n};\n```\n\n## ARQUIVOS CRÃTICOS (NÃƒO MEXER SEM CUIDADO)\n\n1. **src/hooks/useFeatureAccess.js**\n   - âš ï¸ Controla acesso Ã s 33 features\n   - âš ï¸ Alterar FEATURE_MATRIX afeta todos os paywalls\n   - âš ï¸ Testar EXAUSTIVAMENTE apÃ³s qualquer mudanÃ§a\n\n2. **api/webhooks/stripe.js**\n   - âš ï¸ Sincroniza pagamentos Stripe â†’ Supabase\n   - âš ï¸ Erro aqui = usuÃ¡rio paga mas nÃ£o recebe upgrade\n   - âš ï¸ NUNCA commitar com console.logs removidos (essenciais debug)\n\n3. **api/create-checkout-session.js**\n   - âš ï¸ Cria sessÃ£o de checkout Stripe\n   - âš ï¸ Validar SEMPRE user_id antes de criar\n   - âš ï¸ Retornar URL de checkout para redirect\n\n4. **src/lib/supabase.js**\n   - âš ï¸ Cliente Supabase global\n   - âš ï¸ Credenciais em .env (NUNCA hardcode)\n\n5. **.env**\n   - âš ï¸âš ï¸ NUNCA commitar\n   - âš ï¸âš ï¸ JÃ¡ estÃ¡ em .gitignore\n   - âš ï¸âš ï¸ Verificar duplo antes de commit",
  
  "changes_guide": "# GUARDADINHEIRO - GUIA DE MUDANÃ‡AS SEGURAS\n\n## REGRAS DE OURO (NUNCA QUEBRAR)\n\n### ğŸš¨ NUNCA FAÃ‡A ISSO:\n\n1. **âŒ Alterar FEATURE_MATRIX sem plano claro**\n   - Arquivo: `src/hooks/useFeatureAccess.js` (linhas 14-51)\n   - Por quÃª: Afeta 33 features e todos os paywalls do app\n   - Como fazer certo:\n     - Listar features afetadas\n     - Testar manualmente cada tier (Free/Pro/Premium)\n     - Verificar FeatureUnlock renderiza corretamente\n     - Confirmar upgrade prompts aparecem\n\n2. **âŒ Remover console.logs de CheckoutModal.jsx**\n   - Por quÃª: SÃ£o essenciais para debug de checkout\n   - Stripe Ã© caixa preta - logs sÃ£o Ãºnica forma de rastrear problemas\n\n3. **âŒ Alterar RLS Policies sem testes exaustivos**\n   - Por quÃª: Risco de vazamento de dados entre usuÃ¡rios\n   - Como testar:\n     - Login com 2 usuÃ¡rios diferentes\n     - Verificar que User A nÃ£o vÃª dados User B\n     - Testar todas as tabelas: profiles, transactions, budgets, goals\n\n4. **âŒ Fazer transaÃ§Ã£o financeira sem atomicidade**\n   - Por quÃª: Risco de inconsistÃªncia (ex: orÃ§amento atualiza mas transaÃ§Ã£o falha)\n   - Como fazer certo: Usar Supabase RPC functions (transaÃ§Ãµes SQL)\n\n5. **âŒ Usar `any` em TypeScript**\n   - Por quÃª: Mata o propÃ³sito do TS\n   - Alternativa: Use `unknown` + type guards\n\n6. **âŒ Commitar secrets no cÃ³digo**\n   - Por quÃª: SeguranÃ§a bÃ¡sica\n   - Sempre: .env local + Vercel env vars produÃ§Ã£o\n\n7. **âŒ Deploy sem testar localmente**\n   - Por quÃª: Vercel build pode ter comportamento diferente\n   - Processo: `npm run build` â†’ `npm run preview` â†’ testar manualmente â†’ deploy\n\n8. **âŒ Duplicar componente existente**\n   - Por quÃª: 61 componentes jÃ¡ mapeados\n   - Sempre: Verificar `.claude/GUARDADINHEIRO_INVENTARIO_COMPLETO.md` primeiro\n\n## CHECKLIST PRÃ‰-MUDANÃ‡A\n\n```\n[ ] Li contexto completo do projeto?\n[ ] Verifiquei se cÃ³digo/componente jÃ¡ existe?\n[ ] Entendi padrÃµes estabelecidos (naming, error handling)?\n[ ] Li documentaÃ§Ã£o interna (.claude/*.md)?\n[ ] Tenho backup do cÃ³digo atual (mentalmente ou git stash)?\n```\n\n## CHECKLIST PÃ“S-MUDANÃ‡A\n\n```\n[ ] CÃ³digo compila sem erros TypeScript?\n[ ] Testei manualmente a funcionalidade?\n[ ] Testei com 3 tiers (Free/Pro/Premium)?\n[ ] NÃ£o quebrei features existentes?\n[ ] Logs adicionados para debug?\n[ ] RLS policies funcionam (se database)?\n[ ] Stripe webhook funciona (se pagamentos)?\n[ ] Build produÃ§Ã£o funciona? (npm run build)\n```\n\n## ARQUIVOS CRÃTICOS - CUIDADO EXTRA\n\n### 1. `src/hooks/useFeatureAccess.js`\n**Por quÃª Ã© crÃ­tico:** Define acesso Ã s 33 features do app\n\n**Quando mexer:**\n- Adicionar nova feature paga\n- Mover feature entre tiers\n- Criar novo tier\n\n**Como mexer:**\n1. Adicionar feature no FEATURE_MATRIX\n2. Atualizar documentaÃ§Ã£o\n3. Criar teste manual:\n   ```\n   - Login Free â†’ verificar bloqueio\n   - Login Pro â†’ verificar acesso\n   - Login Premium â†’ verificar acesso\n   ```\n\n**Sintomas de erro:**\n- FeatureUnlock nÃ£o bloqueia\n- Upgrade prompt nÃ£o aparece\n- Feature acessÃ­vel no tier errado\n\n### 2. `api/webhooks/stripe.js`\n**Por quÃª Ã© crÃ­tico:** Sincroniza pagamentos\n\n**Quando mexer:**\n- Mudar lÃ³gica de upgrade\n- Adicionar novo plano\n- Tratar novos eventos Stripe\n\n**Como mexer:**\n1. NUNCA remover console.logs\n2. SEMPRE retornar 200 (Stripe retenta se != 200)\n3. Validar assinatura Stripe (`stripe.webhooks.constructEvent`)\n4. Testar com Stripe CLI: `stripe listen --forward-to localhost:3000/api/webhooks/stripe`\n\n**Sintomas de erro:**\n- User paga mas nÃ£o recebe upgrade\n- Subscription_status desatualizado\n- Logs no Stripe Dashboard com erro 4xx/5xx\n\n### 3. `api/create-checkout-session.js`\n**Por quÃª Ã© crÃ­tico:** Cria checkout Stripe\n\n**Quando mexer:**\n- Adicionar novo plano\n- Mudar preÃ§os\n- Alterar fluxo de checkout\n\n**Como mexer:**\n1. SEMPRE validar user_id antes de criar sessÃ£o\n2. SEMPRE retornar URL de checkout\n3. Testar modo TEST primeiro (Stripe test keys)\n4. SÃ³ depois migrar para LIVE\n\n**Sintomas de erro:**\n- User nÃ£o consegue abrir checkout\n- Erro \"Customer not found\" no Stripe\n- Checkout abre mas nÃ£o vincula user\n\n### 4. `.env`\n**Por quÃª Ã© crÃ­tico:** Credenciais sensÃ­veis\n\n**O que tem:**\n```bash\nVITE_SUPABASE_URL=...\nVITE_SUPABASE_ANON_KEY=...\nVITE_STRIPE_PUBLISHABLE_KEY=...\nSTRIPE_SECRET_KEY=...         # âš ï¸ NUNCA expor frontend\nOPENAI_API_KEY=...            # âš ï¸ NUNCA expor frontend\nSTRIPE_WEBHOOK_SECRET=...     # âš ï¸ Validar webhooks\n```\n\n**Como mexer:**\n1. NUNCA commitar\n2. Verificar .gitignore (jÃ¡ deve ter .env)\n3. ProduÃ§Ã£o: VariÃ¡veis em Vercel Dashboard\n4. Compartilhar: Usar 1Password/Bitwarden (nunca email/Slack)\n\n## DEBUGGING STRIPE (PROBLEMAS COMUNS)\n\n### Problema: \"Checkout nÃ£o abre\"\n**DiagnÃ³stico:**\n1. Verificar console do browser (erros JS)\n2. Verificar Network tab (chamada API falhou?)\n3. Verificar logs Vercel Functions\n\n**SoluÃ§Ã£o comum:**\n- Stripe publishable key incorreta (.env)\n- CORS bloqueando request\n- User nÃ£o autenticado (token invÃ¡lido)\n\n### Problema: \"User pagou mas nÃ£o recebeu upgrade\"\n**DiagnÃ³stico:**\n1. Verificar Stripe Dashboard â†’ Webhooks â†’ Ver eventos\n2. Verificar se webhook chegou em `api/webhooks/stripe.js`\n3. Verificar logs da function (console.logs)\n4. Verificar Supabase â†’ profiles â†’ plan_slug do user\n\n**SoluÃ§Ã£o comum:**\n- Webhook nÃ£o configurado (adicionar URL no Stripe)\n- Webhook secret incorreto (.env)\n- Function retornou erro (Stripe retenta 3x e desiste)\n- RLS policy bloqueou update\n\n### Problema: \"Teste mode funciona, LIVE mode nÃ£o\"\n**DiagnÃ³stico:**\n- Verificar se .env tem keys LIVE corretas\n- Verificar se webhook LIVE estÃ¡ configurado no Stripe\n- Verificar se produtos LIVE existem no Stripe\n\n**SoluÃ§Ã£o comum:**\n- Usando test keys em produÃ§Ã£o\n- Webhook aponta para URL dev (localhost)\n- Produtos nÃ£o migrados de TEST â†’ LIVE\n\n## DEBUGGING SUPABASE (PROBLEMAS COMUNS)\n\n### Problema: \"Query retorna vazio mas deveria ter dados\"\n**DiagnÃ³stico:**\n1. Verificar RLS policies (podem estar bloqueando)\n2. Verificar `user_id` na query estÃ¡ correto\n3. Verificar dados existem no banco (SQL Editor)\n\n**SoluÃ§Ã£o comum:**\n- User nÃ£o autenticado (RLS bloqueia)\n- RLS policy mal configurada\n- Query filtrando errado (eq vs. in)\n\n### Problema: \"Insert/Update falha silenciosamente\"\n**DiagnÃ³stico:**\n1. Verificar `error` retornado por Supabase\n2. Verificar constraints da tabela (NOT NULL, FOREIGN KEY)\n3. Verificar RLS policy permite operaÃ§Ã£o\n\n**SoluÃ§Ã£o comum:**\n- Campo obrigatÃ³rio null\n- Foreign key invÃ¡lida\n- RLS policy bloqueia insert\n\n## QUANDO PEDIR AJUDA\n\nğŸš¨ **PEDIR AJUDA SE:**\n- Erro persiste apÃ³s 2 tentativas\n- NÃ£o entende comportamento inesperado\n- Precisa refatorar cÃ³digo crÃ­tico (FEATURE_MATRIX, webhooks)\n- MudanÃ§a afeta mÃºltiplos arquivos\n- Envolve seguranÃ§a (RLS, auth, pagamentos)\n- DÃºvida sobre arquitetura (onde adicionar feature)\n\nâœ… **ANTES DE PEDIR:**\n- Ler documentaÃ§Ã£o interna (.claude/*.md)\n- Verificar console browser + logs Vercel\n- Testar com user de teste (dev@test.com)\n- Reproduzir erro consistentemente\n\n## RECURSOS ÃšTEIS\n\nğŸ“š **DocumentaÃ§Ã£o:**\n- `.claude/GUARDADINHEIRO_INVENTARIO_COMPLETO.md` - 61 componentes mapeados\n- `.claude/GUARDADINHEIRO_REGRAS_CRITICAS_E_ROADMAP.md` - Problemas conhecidos\n- Stripe Docs: https://stripe.com/docs\n- Supabase Docs: https://supabase.com/docs\n\nğŸ”§ **Ferramentas:**\n- Stripe CLI: Testar webhooks localmente\n- Supabase SQL Editor: Executar queries diretamente\n- React DevTools: Debugar componentes\n- Vercel Logs: Ver logs de functions\n\nğŸ‘¤ **User de Teste:**\n- Email: dev@test.com\n- Senha: Test1234!\n- Supabase: https://nldhhkytxdaqaslmczsi.supabase.co",
  
  "arquivos_principais": [
    "src/App.tsx",
    "src/components/FeatureUnlock.jsx",
    "src/hooks/useFeatureAccess.js",
    "src/context/TierContext.jsx",
    "src/lib/supabase.js",
    "src/lib/stripe.js",
    "src/lib/subscription.js",
    "api/create-checkout-session.js",
    "api/webhooks/stripe.js",
    "api/chat-assistant.js",
    ".env"
  ],
  
  "padroes": [
    "SEMPRE verificar no inventÃ¡rio se componente jÃ¡ existe antes de criar",
    "Componentes: PascalCase (CheckoutModal.jsx), Hooks: camelCase com 'use' (useFeatureAccess.js)",
    "SEMPRE usar try-catch com console.error('[GuardaDinheiro] Contexto:', error)",
    "Feature gating: SEMPRE usar <FeatureUnlock featureId='...'> para bloquear features pagas",
    "Supabase queries: SEMPRE verificar { error } retornado, NUNCA assumir sucesso",
    "API routes: SEMPRE validar auth token, SEMPRE retornar status code correto",
    "Stripe: NUNCA remover console.logs de checkout/webhooks (essenciais debug)",
    "TypeScript: NUNCA usar 'any', preferir 'unknown' + type guards",
    "Deploy: SEMPRE testar build local (npm run build â†’ preview) antes de deploy",
    "RLS Policies: SEMPRE testar com 2 users diferentes para evitar vazamento dados",
    "FEATURE_MATRIX: NUNCA alterar sem testar manualmente os 3 tiers (Free/Pro/Premium)",
    ".env: NUNCA commitar, SEMPRE usar Vercel env vars em produÃ§Ã£o"
  ]
}
